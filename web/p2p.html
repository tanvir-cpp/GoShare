<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description"
    content="GoShare P2P — Share files directly between browsers using WebRTC. Generate a link or QR code for instant peer-to-peer transfer.">
  <title>GoShare — P2P</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>

<body>

  <!-- Navbar -->
  <nav class="navbar">
    <div class="navbar-inner">
      <a href="index.html" class="navbar-brand">
        <span class="logo-dot"></span>
        GoShare
      </a>
      <div class="navbar-links">
        <a href="lan.html" class="navbar-link">LAN</a>
        <a href="p2p.html" class="navbar-link active">P2P</a>
        <a href="https://github.com/tanvir-cpp/GoShare" target="_blank" rel="noopener" class="navbar-link-icon"
          title="GitHub">
          <svg fill="currentColor" viewBox="0 0 24 24">
            <path
              d="M12 0C5.37 0 0 5.37 0 12c0 5.31 3.435 9.795 8.205 11.385.6.105.825-.255.825-.57 0-.285-.015-1.23-.015-2.235-3.015.555-3.795-.735-4.035-1.41-.135-.345-.72-1.41-1.23-1.695-.42-.225-1.02-.78-.015-.795.945-.015 1.62.87 1.845 1.23 1.08 1.815 2.805 1.305 3.495.99.105-.78.42-1.305.765-1.605-2.67-.3-5.46-1.335-5.46-5.925 0-1.305.465-2.385 1.23-3.225-.12-.3-.54-1.53.12-3.18 0 0 1.005-.315 3.3 1.23.96-.27 1.98-.405 3-.405s2.04.135 3 .405c2.295-1.56 3.3-1.23 3.3-1.23.66 1.65.24 2.88.12 3.18.765.84 1.23 1.905 1.23 3.225 0 4.605-2.805 5.625-5.475 5.925.435.375.81 1.095.81 2.22 0 1.605-.015 2.895-.015 3.3 0 .315.225.69.825.57A12.02 12.02 0 0 0 24 12c0-6.63-5.37-12-12-12Z" />
          </svg>
        </a>
      </div>
    </div>
  </nav>

  <main class="p2p-page">

    <!-- ─── SENDER VIEW (default) ─── -->
    <div id="senderView">
      <div class="p2p-hero">
        <h1>P2P <span class="text-gradient">Share</span></h1>
        <p>Select a file to generate a shareable link and QR code</p>
      </div>

      <!-- File Select Area -->
      <button id="fileSelectArea" class="file-select-area" onclick="document.getElementById('fileInput').click()"
        onkeydown="event.key === 'Enter' && document.getElementById('fileInput').click()">
        <div class="icon-wrapper">
          <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round"
              d="M12 16.5V9.75m0 0 3 3m-3-3-3 3M6.75 19.5a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z" />
          </svg>
        </div>
        <h3>Drop file here or click to browse</h3>
        <p>Any file type, up to 2 GB</p>
      </button>
      <input type="file" id="fileInput" style="display:none" />

      <!-- Selected File Info -->
      <div id="selectedFile" class="selected-file-card hidden">
        <div class="file-info-row">
          <div class="file-icon">
            <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="m18.375 12.739-7.693 7.693a4.5 4.5 0 0 1-6.364-6.364l10.94-10.94A3 3 0 1 1 19.5 7.372L8.552 18.32m.009-.01-.01.01m5.699-9.941-7.81 7.81a1.5 1.5 0 0 0 2.112 2.13" />
            </svg>
          </div>
          <div class="file-details">
            <div class="file-name" id="fileName"></div>
            <div class="file-size" id="fileSize"></div>
          </div>
          <button onclick="clearFile()" class="remove-btn" title="Remove">&times;</button>
        </div>
        <button id="shareBtn" onclick="createRoom()" class="btn btn-accent btn-block mt-4">
          Generate Share Link
        </button>
      </div>

      <!-- Share Link + QR -->
      <div id="shareInfo" class="share-info hidden">
        <div class="share-card">
          <p>Share this link or scan QR to receive the file</p>
          <div id="qrcode"></div>
          <div class="share-url-row">
            <span class="share-url-text" id="shareUrl"></span>
            <button onclick="copyLink()" class="copy-btn">
              <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                  d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9.75a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184" />
              </svg>
              Copy
            </button>
          </div>
          <div id="waitingStatus" class="waiting-status">
            <div class="waiting-dot"></div>
            Waiting for receiver to connect...
          </div>
        </div>
      </div>

      <!-- Transfer Progress -->
      <div id="senderProgress" class="transfer-card hidden">
        <div class="transfer-inner">
          <div class="transfer-header">
            <span class="transfer-label" id="progressLabel">Sending...</span>
            <span class="transfer-percent" id="progressPercent">0%</span>
          </div>
          <div class="transfer-bar">
            <div id="progressBar" class="transfer-fill" style="width: 0%"></div>
          </div>
          <div class="transfer-detail" id="progressDetail"></div>
        </div>
      </div>

      <!-- Done -->
      <div id="senderDone" class="result-card hidden">
        <div class="result-inner success">
          <div class="result-icon success">
            <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
            </svg>
          </div>
          <h2>Transfer Complete!</h2>
          <p>File has been sent successfully.</p>
          <button onclick="resetSender()" class="btn btn-ghost mt-6" style="color:var(--accent)">
            Share another file
          </button>
        </div>
      </div>
    </div>

    <!-- ─── RECEIVER VIEW ─── -->
    <div id="receiverView" class="hidden">
      <div class="p2p-hero">
        <h1>P2P <span class="text-gradient">Receive</span></h1>
        <p>A file is being shared with you</p>
      </div>

      <div style="max-width:520px;margin:0 auto">
        <!-- Connecting -->
        <div id="recvConnecting" class="connecting-card">
          <div class="connecting-icon">
            <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244" />
            </svg>
          </div>
          <h2>Connecting to sender...</h2>
          <p>Establishing a direct peer-to-peer connection</p>
        </div>

        <!-- Receiving progress -->
        <div id="recvProgress" class="hidden">
          <div class="transfer-inner">
            <div class="recv-file-row">
              <div class="recv-icon">
                <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round"
                    d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
                </svg>
              </div>
              <div class="recv-details">
                <div class="recv-name" id="recvFileName"></div>
                <div class="recv-size" id="recvFileSize"></div>
              </div>
            </div>
            <div class="transfer-header">
              <span class="transfer-label">Receiving...</span>
              <span class="transfer-percent" id="recvPercent">0%</span>
            </div>
            <div class="transfer-bar">
              <div id="recvBar" class="transfer-fill" style="width: 0%"></div>
            </div>
          </div>
        </div>

        <!-- Done -->
        <div id="recvDone" class="result-card hidden">
          <div class="result-inner success">
            <div class="result-icon success">
              <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                  d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
              </svg>
            </div>
            <h2>File Received!</h2>
            <p id="recvDoneFile"></p>
            <a id="recvDownloadLink" class="btn btn-accent mt-4" style="display:inline-flex">
              Download File
            </a>
            <div class="mt-6">
              <a href="p2p.html" class="btn btn-ghost" style="color:var(--accent)">Share your own file</a>
            </div>
          </div>
        </div>

        <!-- Error -->
        <div id="recvError" class="result-card hidden">
          <div class="result-inner error">
            <div class="result-icon error">
              <svg fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round"
                  d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z" />
              </svg>
            </div>
            <h2>Connection Failed</h2>
            <p id="recvErrorMsg">Could not connect to the sender. The link may have expired.</p>
            <a href="p2p.html" class="btn btn-ghost mt-4" style="color:var(--accent)">Go back</a>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="p2p-footer">
    GoShare &mdash; Open-source file sharing
  </footer>

  <div id="toastEl" class="toast accent">
    Copied!
  </div>

  <script src="p2p.js"></script>
</body>

</html>