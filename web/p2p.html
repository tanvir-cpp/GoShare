<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>GoShare — P2P</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              bg: "#0d0d12",
              card: "#18181b",
              "card-hover": "#252529",
              border: "rgba(255, 255, 255, 0.04)",
              accent: "#818cf8",
              "accent-soft": "rgba(129, 140, 248, 0.05)",
              success: "#34d399",
              danger: "#f87171",
              muted: "#71717a",
            },
            borderRadius: {
              soft: "1rem",
              "soft-lg": "1.5rem",
            },
          },
        },
      };
    </script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Hanken+Grotesk:wght@400;500;600&display=swap");

      body {
        font-family: "Hanken Grotesk", system-ui, sans-serif;
      }

      .grid-bg {
        background-image:
          radial-gradient(
            circle at 50% 50%,
            rgba(129, 140, 248, 0.02) 0%,
            transparent 50%
          ),
          linear-gradient(
            to right,
            rgba(255, 255, 255, 0.005) 1px,
            transparent 1px
          ),
          linear-gradient(
            to bottom,
            rgba(255, 255, 255, 0.005) 1px,
            transparent 1px
          );
        background-size:
          100% 100%,
          60px 60px,
          60px 60px;
      }

      .pulse {
        animation: pulse 2s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      #qrcode canvas {
        border-radius: 8px;
      }
    </style>
  </head>

  <body
    class="bg-bg grid-bg min-h-screen text-white flex flex-col items-center select-none"
  >
    <!-- Top Navigation Bar -->
    <nav
      class="fixed top-0 left-0 right-0 h-14 border-b border-white/[0.04] bg-bg/80 backdrop-blur-xl z-[150] flex items-center px-6 justify-between"
    >
      <div class="flex items-center gap-6">
        <a
          href="/"
          class="font-semibold text-sm tracking-tight hover:opacity-70 transition"
          ><span class="text-blue-500">go</span>share</a
        >
        <span
          class="text-[10px] font-medium uppercase tracking-widest text-zinc-500 hidden sm:block"
          >Global P2P</span
        >
      </div>
      <div class="flex items-center gap-6">
        <button onclick="changeName()" class="text-zinc-500 hover:text-white transition">
          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
            <path d="M12 15a3 3 0 100-6 3 3 0 000 6z" />
            <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z" />
          </svg>
        </button>
        <a
          href="/lan.html"
          class="text-[10px] font-medium text-zinc-500 hover:text-white transition-all uppercase tracking-widest"
          >Nearby LAN</a
        >
        <div class="w-1.5 h-1.5 rounded-full bg-accent animate-pulse"></div>
      </div>
    </nav>

    <main class="flex-1 w-full max-w-4xl px-6 mt-20 sm:mt-32">
      <!-- SENDER VIEW (default) -->
      <div id="senderView" class="">
        <div class="text-center mb-12 sm:mb-16">
          <div
            class="inline-flex items-center gap-2 px-3 py-1 bg-white/[0.03] border border-white/[0.05] rounded-full text-[10px] font-medium tracking-wide text-zinc-400 mb-8"
          >
            <span>Identity:</span>
            <span id="userNameDisplay" class="text-white">Anonymous</span>
          </div>
          <h1 class="text-3xl sm:text-4xl font-semibold tracking-tighter mb-4 text-white">
            Anywhere
          </h1>
          <p
            class="text-zinc-500 text-[10px] sm:text-xs font-medium uppercase tracking-widest"
          >
            Secure browser-to-browser tunnel
          </p>
        </div>

        <!-- File Select Area -->
        <div
          id="fileSelectArea"
          class="max-w-md mx-auto aspect-video bg-white/[0.02] border border-dashed border-white/[0.1] rounded-soft-lg p-8 sm:p-12 text-center cursor-pointer hover:bg-white/[0.04] transition-colors flex flex-col items-center justify-center group"
          onclick="document.getElementById('fileInput').click()"
        >
          <div
            class="w-12 h-12 mb-6 bg-white/[0.03] border border-white/[0.05] rounded-2xl flex items-center justify-center text-zinc-400 group-hover:scale-110 transition-transform"
          >
            <svg
              class="w-6 h-6"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="2"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M12 16.5V9.75m0 0 3 3m-3-3-3 3M6.75 19.5a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z"
              />
            </svg>
          </div>
          <span class="text-sm font-medium text-white/60"
            >Stage files for transport</span
          >
        </div>
        <input type="file" id="fileInput" multiple class="hidden" />

        <div id="selectedFile" class="hidden max-w-md mx-auto mt-12">
          <div id="fileList" class="space-y-2 mb-8">
            <!-- Files will be listed here -->
          </div>
          <button
            id="shareBtn"
            onclick="createRoom()"
            class="w-full py-4 bg-white text-black rounded-full text-[11px] font-semibold uppercase tracking-widest transition-opacity hover:opacity-90"
          >
            Open Pipeline
          </button>
        </div>

        <!-- Share Link + QR -->
        <div id="shareInfo" class="hidden max-w-md mx-auto mt-12">
          <div
            class="bg-card border border-white/[0.05] rounded-soft-lg p-10 text-center shadow-2xl animate-in fade-in slide-in-from-bottom-4 duration-500"
          >
            <p
              class="text-zinc-500 text-[9px] uppercase tracking-widest font-semibold mb-8"
            >
              Access Key Generated
            </p>
            <div
              id="qrcode"
              class="flex justify-center mb-8 p-4 bg-white rounded-xl"
            ></div>
            <div
              class="flex items-center gap-3 bg-white/[0.02] border border-white/[0.05] rounded-full pl-6 pr-2 py-2"
            >
              <span
                class="flex-1 text-[10px] truncate text-zinc-400 font-mono"
                id="shareUrl"
              ></span>
              <button
                onclick="copyLink()"
                class="px-4 py-2 bg-white text-black rounded-full text-[9px] font-semibold uppercase tracking-widest flex items-center gap-2 hover:opacity-90 transition-opacity"
              >
                Copy
              </button>
            </div>
            <div
              id="waitingStatus"
              class="mt-8 flex items-center justify-center gap-3 text-zinc-500 text-[10px] font-medium uppercase tracking-widest"
            >
              <div
                class="w-1.5 h-1.5 rounded-full bg-accent animate-pulse"
              ></div>
              Awaiting Connection
            </div>
          </div>
        </div>

        <!-- Unified Transfer Overlay -->
        <div id="transferOverlay"
          class="fixed inset-0 bg-bg/95 backdrop-blur-3xl z-[1000] hidden flex items-center justify-center p-6 text-white text-center">
          <div class="w-full max-w-xs scale-95 opacity-0 transition-all duration-300" id="transferCard">
            <div class="mb-12">
              <div id="transferIcon"
                class="w-16 h-16 mx-auto mb-6 bg-white/[0.03] border border-white/[0.05] rounded-2xl flex items-center justify-center transition-all">
                <svg class="w-6 h-6 text-zinc-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M7 16V4m0 0L3 8m4-4l4 4m6 0v12m0 0l4-4m-4 4l-4-4" />
                </svg>
              </div>
              <h2 id="transferName" class="text-base font-semibold tracking-tight truncate mb-1">Transferring</h2>
              <p id="transferStage" class="text-[9px] uppercase tracking-widest text-zinc-500 font-medium">Preparing...</p>
            </div>

            <div class="relative h-px mb-10 bg-white/[0.05] overflow-hidden">
              <div id="transferBar" class="absolute inset-y-0 left-0 bg-white transition-all duration-300" style="width: 0%">
              </div>
            </div>

            <div class="grid grid-cols-3 gap-4 mb-12">
              <div class="text-center">
                <div class="text-[8px] uppercase tracking-widest text-zinc-600 mb-2 font-medium">Progress</div>
                <div id="uiPercent" class="text-[10px] font-medium font-mono">0%</div>
              </div>
              <div class="text-center">
                <div class="text-[8px] uppercase tracking-widest text-zinc-600 mb-2 font-medium">Speed</div>
                <div id="uiSpeed" class="text-[10px] font-medium font-mono">0 KB/s</div>
              </div>
              <div class="text-center">
                <div class="text-[8px] uppercase tracking-widest text-zinc-600 mb-2 font-medium">ETA</div>
                <div id="uiEta" class="text-[10px] font-medium font-mono">--:--</div>
              </div>
            </div>

            <button id="abortBtn" onclick="abortTransfer()"
              class="w-full py-3.5 border border-white/[0.1] text-[9px] uppercase tracking-widest font-semibold hover:bg-white hover:text-black transition-colors rounded-full">
              Cancel Transmission
            </button>
          </div>
        </div>
      </div>

      <!-- RECEIVER VIEW -->
      <div id="receiverView" class="hidden">
        <div class="text-center mb-16">
          <div
            class="inline-flex items-center gap-2 px-3 py-1 bg-white/[0.03] border border-white/[0.05] rounded-full text-[10px] font-medium tracking-wide text-zinc-400 mb-8">
            <span>Connection:</span>
            <span id="remoteUserName" class="text-white">Active Pipeline</span>
          </div>
          <h1 class="text-4xl font-semibold tracking-tighter mb-4 text-white">
            Inbound
          </h1>
          <p class="text-zinc-500 text-xs font-medium uppercase tracking-widest">
            Securing global data stream
          </p>
        </div>

        <div class="max-w-md mx-auto bg-card border border-white/[0.05] rounded-soft-lg p-10 text-center shadow-2xl">
          <div
            class="w-16 h-16 mx-auto mb-8 bg-white/[0.03] border border-white/[0.05] rounded-2xl flex items-center justify-center text-zinc-400">
            <svg class="w-8 h-8" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3" />
            </svg>
          </div>
          <p class="text-sm font-medium text-white/90 mb-4" id="receiverFilesText">
            Ready to receive files
          </p>
          <div id="receiverStatus" class="flex items-center justify-center gap-3 text-zinc-500 text-[10px] font-medium uppercase tracking-widest">
            <div class="w-1.5 h-1.5 rounded-full bg-accent animate-pulse"></div>
            Connected & Listening
          </div>
        </div>
      </div>
              <svg
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"
                />
              </svg>
            </div>
            <h2 class="font-bold text-lg mb-2 uppercase tracking-tight">
              Establishing Link
            </h2>
            <p
              class="text-zinc-500 text-[10px] uppercase tracking-widest font-bold"
            >
              Direct Peer-to-Peer Tunneling
            </p>
          </div>

          <!-- Error -->
          <div
            id="recvError"
            class="hidden bg-card border border-danger/30 rounded-2xl p-8 text-center"
          >
            <div class="w-14 h-14 mx-auto mb-3 text-danger">
              <svg
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"
                />
              </svg>
            </div>
            <h2 class="text-xl font-bold mb-1">Connection Failed</h2>
            <p class="text-slate-400 text-sm" id="recvErrorMsg">
              Could not connect to the sender. The link may have expired.
            </p>
            <a
              href="/p2p.html"
              class="inline-block mt-4 text-accent hover:underline text-sm font-semibold"
              >Go back</a
            >
          </div>
        </div>
      </div>
    </main>

    <!-- Transfer Request Modal -->
    <div
      id="requestModal"
      class="fixed inset-0 bg-bg/80 backdrop-blur-md z-[500] hidden flex items-center justify-center p-6"
    >
      <div
        class="bg-card border border-border rounded-3xl p-8 w-full max-w-sm shadow-2xl scale-95 transition-transform duration-300"
      >
        <div
          class="w-16 h-16 bg-accent/10 rounded-2xl flex items-center justify-center mx-auto mb-6"
        >
          <svg
            class="w-8 h-8 text-accent"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M9 19l3 3m0 0l3-3m-3 3V10"
            />
          </svg>
        </div>
        <h3 class="text-xl font-bold text-center mb-2">Incoming Files</h3>
        <p class="text-slate-400 text-center text-sm mb-6" id="requestInfo">
          Sender wants to share 3 files (45 MB)
        </p>
        <div class="flex gap-3">
          <button
            onclick="respondToTransfer(false)"
            class="flex-1 py-3 px-4 rounded-xl border border-border font-semibold hover:bg-white/5 transition"
          >
            Decline
          </button>
          <button
            onclick="respondToTransfer(true)"
            class="flex-1 py-3 px-4 rounded-xl bg-accent text-black font-bold hover:bg-white transition shadow-[0_0_15px_rgba(167,139,250,0.3)]"
          >
            Accept
          </button>
        </div>
      </div>
    </div>

    <!-- Name Change Modal -->
    <div
      id="nameModal"
      class="fixed inset-0 bg-bg/80 backdrop-blur-md z-[600] hidden flex items-center justify-center p-6"
    >
      <div
        class="bg-card border border-white/[0.05] rounded-soft-lg p-8 w-full max-w-sm shadow-2xl scale-95 opacity-0 transition-all duration-300"
        id="nameModalCard"
      >
        <h3 class="text-xl font-semibold tracking-tight text-white mb-1">Identity</h3>
        <p class="text-zinc-500 text-xs font-medium mb-8">
          Update how you appear in global transfers
        </p>

        <div class="relative mb-8">
          <input
            type="text"
            id="newNameInput"
            class="w-full bg-white/[0.02] border border-white/[0.05] rounded-full px-5 py-3 outline-none focus:border-white transition-colors text-white text-sm"
            placeholder="Name"
            maxlength="20"
          />
        </div>

        <div class="flex gap-2">
          <button
            onclick="closeNameModal()"
            class="flex-1 py-3 font-semibold text-[10px] uppercase tracking-widest text-zinc-500 hover:text-white transition"
          >
            Cancel
          </button>
          <button
            onclick="saveNameFromModal()"
            class="flex-1 py-3 rounded-full bg-white text-black font-semibold text-[10px] uppercase tracking-widest hover:opacity-90 transition"
          >
            Update
          </button>
        </div>
      </div>
    </div>

    <footer class="text-center text-zinc-600 text-[10px] uppercase tracking-widest font-medium py-12">
      GoShare — Secure P2P
    </footer>
          d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"
        />
        <path
          stroke-linecap="round"
          stroke-linejoin="round"
          stroke-width="2"
          d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"
        />
      </svg>
    </button>

    <div
      id="toastEl"
      class="fixed bottom-6 left-1/2 -translate-x-1/2 bg-card border border-border text-white px-6 py-3 rounded-xl text-sm font-medium shadow-lg transition-all duration-300 opacity-0 translate-y-4 pointer-events-none z-50"
    >
      Copied!
    </div>

    <script src="/p2p.js"></script>
  </body>
</html>
