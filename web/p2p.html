<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>GoShare â€” P2P</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              bg: "#09090b",
              card: "#18181b",
              border: "#27272a",
              accent: "#8b5cf6",
              success: "#22c55e",
              danger: "#ef4444",
            },
          },
        },
      };
    </script>
    <style>
      @import url("https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap");
      body {
        font-family: "Inter", system-ui, sans-serif;
      }
      .pulse {
        animation: pulse 2s ease-in-out infinite;
      }
      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }
      #qrcode canvas {
        border-radius: 12px;
      }
    </style>
  </head>
  <body class="bg-bg min-h-screen text-white">
    <!-- Nav -->
    <nav
      class="w-full px-6 py-4 flex items-center justify-between max-w-4xl mx-auto"
    >
      <a href="/" class="text-xl font-extrabold tracking-tight">
        <span class="text-accent">Go</span>Share
      </a>
      <a
        href="/"
        class="text-slate-400 hover:text-white transition text-sm flex items-center gap-1"
      >
        <svg
          class="w-4 h-4"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M15 19l-7-7 7-7"
          />
        </svg>
        Home
      </a>
    </nav>

    <main class="max-w-4xl mx-auto px-6 pt-8 pb-20">
      <!-- SENDER VIEW (default) -->
      <div id="senderView">
        <div class="text-center mb-10">
          <h1 class="text-3xl sm:text-4xl font-extrabold tracking-tight mb-2">
            P2P <span class="text-accent">Share</span>
          </h1>
          <p class="text-slate-400 text-sm">
            Select a file to generate a shareable link and QR code
          </p>
        </div>

        <!-- File Select Area -->
        <div
          id="fileSelectArea"
          class="max-w-lg mx-auto bg-card border-2 border-dashed border-border rounded-2xl p-10 text-center cursor-pointer hover:border-accent transition-all group"
          onclick="document.getElementById('fileInput').click()"
        >
          <div
            class="w-12 h-12 mx-auto mb-4 text-slate-400 group-hover:text-accent transition-colors group-hover:scale-110 transition-transform"
          >
            <svg
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="1.5"
              stroke="currentColor"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M12 16.5V9.75m0 0 3 3m-3-3-3 3M6.75 19.5a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z"
              />
            </svg>
          </div>
          <p class="font-semibold text-lg mb-1">
            Drop file here or click to browse
          </p>
          <p class="text-slate-500 text-sm">Any file type, up to 2 GB</p>
        </div>
        <input type="file" id="fileInput" class="hidden" />

        <!-- Selected File Info -->
        <div id="selectedFile" class="hidden max-w-lg mx-auto mt-6">
          <div
            class="bg-card border border-border rounded-xl p-4 flex items-center gap-4"
          >
            <div class="w-8 h-8 text-accent flex-shrink-0">
              <svg
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="m18.375 12.739-7.693 7.693a4.5 4.5 0 0 1-6.364-6.364l10.94-10.94A3 3 0 1 1 19.5 7.372L8.552 18.32m.009-.01-.01.01m5.699-9.941-7.81 7.81a1.5 1.5 0 0 0 2.112 2.13"
                />
              </svg>
            </div>
            <div class="flex-1 min-w-0">
              <div class="font-semibold truncate" id="fileName"></div>
              <div class="text-slate-500 text-sm" id="fileSize"></div>
            </div>
            <button
              onclick="clearFile()"
              class="text-slate-500 hover:text-danger transition text-xl"
              title="Remove"
            >
              &times;
            </button>
          </div>
          <button
            id="shareBtn"
            onclick="createRoom()"
            class="w-full mt-4 bg-accent hover:bg-violet-600 text-white font-semibold py-3 rounded-xl transition-all"
          >
            Generate Share Link
          </button>
        </div>

        <!-- Share Link + QR -->
        <div id="shareInfo" class="hidden max-w-lg mx-auto mt-8">
          <div class="bg-card border border-border rounded-2xl p-6 text-center">
            <p class="text-slate-400 text-sm mb-4">
              Share this link or scan QR to receive the file
            </p>
            <div id="qrcode" class="flex justify-center mb-5"></div>
            <div
              class="flex items-center gap-2 bg-bg border border-border rounded-xl px-4 py-3"
            >
              <span
                class="flex-1 text-sm truncate text-slate-300"
                id="shareUrl"
              ></span>
              <button
                onclick="copyLink()"
                class="text-accent hover:text-violet-400 text-sm font-semibold whitespace-nowrap flex items-center gap-1"
              >
                <svg
                  class="w-4 h-4"
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M15.666 3.888A2.25 2.25 0 0 0 13.5 2.25h-3c-1.03 0-1.9.693-2.166 1.638m7.332 0c.055.194.084.4.084.612v0a.75.75 0 0 1-.75.75H9.75a.75.75 0 0 1-.75-.75v0c0-.212.03-.418.084-.612m7.332 0c.646.049 1.288.11 1.927.184 1.1.128 1.907 1.077 1.907 2.185V19.5a2.25 2.25 0 0 1-2.25 2.25H6.75A2.25 2.25 0 0 1 4.5 19.5V6.257c0-1.108.806-2.057 1.907-2.185a48.208 48.208 0 0 1 1.927-.184"
                  />
                </svg>
                Copy
              </button>
            </div>
            <div
              id="waitingStatus"
              class="mt-6 flex items-center justify-center gap-2 text-slate-400 text-sm"
            >
              <div class="w-2 h-2 rounded-full bg-accent pulse"></div>
              Waiting for receiver to connect...
            </div>
          </div>
        </div>

        <!-- Transfer Progress -->
        <div id="senderProgress" class="hidden max-w-lg mx-auto mt-6">
          <div class="bg-card border border-border rounded-2xl p-6">
            <div class="flex items-center justify-between mb-2">
              <span class="font-semibold text-sm" id="progressLabel"
                >Sending...</span
              >
              <span class="text-accent text-sm font-bold" id="progressPercent"
                >0%</span
              >
            </div>
            <div class="w-full h-3 bg-bg rounded-full overflow-hidden">
              <div
                id="progressBar"
                class="h-full bg-accent rounded-full transition-all duration-200"
                style="width: 0%"
              ></div>
            </div>
            <div class="text-slate-500 text-xs mt-2" id="progressDetail"></div>
          </div>
        </div>

        <!-- Done -->
        <div id="senderDone" class="hidden max-w-lg mx-auto mt-6 text-center">
          <div class="bg-card border border-success/30 rounded-2xl p-8">
            <div class="w-14 h-14 mx-auto mb-3 text-success">
              <svg
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"
                />
              </svg>
            </div>
            <h2 class="text-xl font-bold mb-1">Transfer Complete!</h2>
            <p class="text-slate-400 text-sm">
              File has been sent successfully.
            </p>
            <button
              onclick="resetSender()"
              class="mt-6 text-accent hover:underline text-sm font-semibold"
            >
              Share another file
            </button>
          </div>
        </div>
      </div>

      <!-- RECEIVER VIEW -->
      <div id="receiverView" class="hidden">
        <div class="text-center mb-10">
          <h1 class="text-3xl sm:text-4xl font-extrabold tracking-tight mb-2">
            P2P <span class="text-accent">Receive</span>
          </h1>
          <p class="text-slate-400 text-sm">A file is being shared with you</p>
        </div>

        <div class="max-w-lg mx-auto">
          <!-- Connecting -->
          <div
            id="recvConnecting"
            class="bg-card border border-border rounded-2xl p-8 text-center"
          >
            <div class="w-12 h-12 mx-auto mb-4 text-accent pulse">
              <svg
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244"
                />
              </svg>
            </div>
            <h2 class="font-bold text-lg mb-2">Connecting to sender...</h2>
            <p class="text-slate-500 text-sm">
              Establishing a direct peer-to-peer connection
            </p>
          </div>

          <!-- Receiving progress -->
          <div
            id="recvProgress"
            class="hidden bg-card border border-border rounded-2xl p-6"
          >
            <div class="flex items-center gap-4 mb-4">
              <div class="w-8 h-8 text-accent flex-shrink-0">
                <svg
                  fill="none"
                  viewBox="0 0 24 24"
                  stroke-width="1.5"
                  stroke="currentColor"
                >
                  <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5M16.5 12 12 16.5m0 0L7.5 12m4.5 4.5V3"
                  />
                </svg>
              </div>
              <div class="flex-1 min-w-0">
                <div class="font-semibold truncate" id="recvFileName"></div>
                <div class="text-slate-500 text-sm" id="recvFileSize"></div>
              </div>
            </div>
            <div class="flex items-center justify-between mb-2">
              <span class="text-sm text-slate-400">Receiving...</span>
              <span class="text-accent text-sm font-bold" id="recvPercent"
                >0%</span
              >
            </div>
            <div class="w-full h-3 bg-bg rounded-full overflow-hidden">
              <div
                id="recvBar"
                class="h-full bg-accent rounded-full transition-all duration-200"
                style="width: 0%"
              ></div>
            </div>
          </div>

          <!-- Done -->
          <div
            id="recvDone"
            class="hidden bg-card border border-success/30 rounded-2xl p-8 text-center"
          >
            <div class="w-14 h-14 mx-auto mb-3 text-success">
              <svg
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"
                />
              </svg>
            </div>
            <h2 class="text-xl font-bold mb-1">File Received!</h2>
            <p class="text-slate-400 text-sm mb-4" id="recvDoneFile"></p>
            <a
              id="recvDownloadLink"
              class="inline-block bg-accent hover:bg-violet-600 text-white font-semibold py-3 px-8 rounded-xl transition-all cursor-pointer"
            >
              Download File
            </a>
            <div class="mt-4">
              <a
                href="/p2p.html"
                class="text-accent hover:underline text-sm font-semibold"
                >Share your own file</a
              >
            </div>
          </div>

          <!-- Error -->
          <div
            id="recvError"
            class="hidden bg-card border border-danger/30 rounded-2xl p-8 text-center"
          >
            <div class="w-14 h-14 mx-auto mb-3 text-danger">
              <svg
                fill="none"
                viewBox="0 0 24 24"
                stroke-width="1.5"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  d="m9.75 9.75 4.5 4.5m0-4.5-4.5 4.5M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"
                />
              </svg>
            </div>
            <h2 class="text-xl font-bold mb-1">Connection Failed</h2>
            <p class="text-slate-400 text-sm" id="recvErrorMsg">
              Could not connect to the sender. The link may have expired.
            </p>
            <a
              href="/p2p.html"
              class="inline-block mt-4 text-accent hover:underline text-sm font-semibold"
              >Go back</a
            >
          </div>
        </div>
      </div>
    </main>

    <footer class="text-center text-slate-600 text-xs py-6">
      GoShare &mdash; Open-source file sharing
    </footer>

    <div
      id="toastEl"
      class="fixed bottom-6 left-1/2 -translate-x-1/2 bg-card border border-border text-white px-6 py-3 rounded-xl text-sm font-medium shadow-lg transition-all duration-300 opacity-0 translate-y-4 pointer-events-none z-50"
    >
      Copied!
    </div>

    <script src="/p2p.js"></script>
  </body>
</html>
