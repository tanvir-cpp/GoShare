<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Global Sharing â€” GoShare</title>
  <meta name="description" content="Send files to anyone across the world with an encrypted link" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸš€</text></svg>">
  <link rel="stylesheet" href="/static/css/shared.css" />
  <link rel="stylesheet" href="/static/css/p2p.css" />
</head>

<body>
  <div class="grain-overlay"></div>
  <div class="ambient-light"></div>

  <!-- Navbar -->
  <nav class="nav-container">
    <a href="/" class="logo-link">
      <span>GoShare</span>
    </a>

    <div class="nav-switcher">
      <a href="/pages/lan.html">Nearby</a>
      <a href="/pages/p2p.html" class="active">Global</a>
    </div>

    <button onclick="changeName()" class="nav-profile-btn">
      <div class="nav-user-info hidden-sm">
        <div id="navUserName" class="nav-user-name">...</div>
        <div class="nav-user-status">
          Connected <i class="fa-solid fa-circle" style="font-size: 7px;"></i>
        </div>
      </div>
      <div class="nav-avatar-wrapper">
        <div id="navUserIcon" class="nav-avatar"></div>
        <div class="nav-edit-badge">
          <i class="fa-solid fa-pen"></i>
        </div>
      </div>
    </button>
  </nav>

  <!-- Main Content -->
  <main class="content-section app-entrance" style="text-align: center; max-width: 600px;">

    <!-- SENDER VIEW -->
    <div id="senderView">
      <header style="margin-bottom: 2rem;">
        <div
          style="display: inline-block; padding: 0.4rem 1rem; background: var(--surface-light); border: 1px solid var(--border); border-radius: var(--radius-full); font-size: 0.75rem; color: var(--text-dim); margin-bottom: 1.5rem;">
          Sharing as <span id="userNameDisplay" style="color: #fff; font-weight: 600;">...</span>
        </div>
        <h1 class="p2p-title">Share Everywhere</h1>
        <p class="text-muted" style="font-weight: 400; max-width: 400px; margin: 0 auto;">Send files to anyone in the
          world with a secure link</p>
      </header>

      <div class="drop-zone file-select-area" id="fileSelectArea"
        onclick="document.getElementById('fileInput').click()">
        <i class="fa-solid fa-cloud-arrow-up" style="font-size: 32px; margin-bottom: 1rem; color: var(--accent);"></i>
        <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 4px;">Choose Files</div>
        <p class="text-dim" style="font-size: 0.85rem;">Drag and drop files here to start</p>
      </div>
      <input type="file" id="fileInput" multiple style="display: none;" />

      <div id="selectedFile" class="hidden" style="margin-top: 2rem;">
        <div id="fileList"
          style="margin-bottom: 2rem; border: 1px solid var(--border); border-radius: var(--radius-md); background: var(--surface); padding: 1rem; max-height: 200px; overflow-y: auto;">
        </div>
        <button id="shareBtn" onclick="createRoom()" class="btn-primary"
          style="width: 100%; justify-content: center;">Create Secure Link</button>
      </div>

      <!-- Share Info -->
      <div id="shareInfo" class="hidden" style="margin-top: 2rem;">
        <div class="share-card">
          <div id="qrcode" style="margin-bottom: 2rem;"></div>

          <div class="copy-link-box" onclick="copyUrl()" style="margin-bottom: 2rem;">
            <i class="fa-solid fa-link" style="color: var(--accent);"></i>
            <span id="shareUrl" style="flex: 1; text-align: left;">Loading...</span>
            <i class="fa-solid fa-copy" style="color: var(--text-dim);"></i>
          </div>

          <div id="waitingStatus"
            style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; font-size: 0.85rem; color: var(--text-dim);">
            <div
              style="width: 6px; height: 6px; border-radius: 50%; background: var(--accent); animation: pulse 2s infinite;">
            </div>
            Waiting for recipient...
          </div>
        </div>
      </div>
    </div>

    <!-- RECEIVER VIEW -->
    <div id="receiverView" class="hidden">
      <header style="margin-bottom: 3rem;">
        <div
          style="display: inline-block; padding: 0.4rem 1rem; background: var(--surface-light); border: 1px solid var(--border); border-radius: var(--radius-full); font-size: 0.75rem; color: var(--text-dim); margin-bottom: 1.5rem;">
          From: <span id="remoteUserName" style="color: #fff; font-weight: 600;">Someone</span>
        </div>
        <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem;">Secure Transfer</h1>
        <p class="text-muted" style="font-weight: 400;">Encrypted direct connection established</p>
      </header>

      <div id="recvDefault"
        style="background: var(--surface); border: 1px solid var(--border); padding: 2.5rem; border-radius: var(--radius-lg); text-align: center;">
        <div style="color: var(--accent); margin-bottom: 1.25rem;">
          <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
            <polyline points="7 10 12 15 17 10" />
            <line x1="12" y1="15" x2="12" y2="3" />
          </svg>
        </div>
        <p id="receiverFilesText" style="font-weight: 600; margin-bottom: 0.75rem; font-size: 1.1rem;">Files ready to
          download</p>
        <div id="receiverStatus"
          style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; font-size: 0.85rem; color: var(--text-dim);">
          <div
            style="width: 6px; height: 6px; border-radius: 50%; background: currentColor; animation: pulse 2s infinite;">
          </div>
          Connecting...
        </div>
      </div>

      <div id="recvConnecting" class="hidden" style="padding: 4rem 2rem;">
        <div style="font-size: 2rem; animation: pulse 1s infinite;">âš¡</div>
        <p class="text-muted" style="margin-top: 1rem;">Connecting to sender...</p>
      </div>

      <div id="recvError" class="hidden"
        style="background: rgba(239, 68, 68, 0.05); border: 1px solid var(--danger); padding: 3rem; border-radius: var(--radius-lg);">
        <h3 style="color: var(--danger); margin-bottom: 1rem;">Connection Failed</h3>
        <p id="recvErrorMsg" class="text-muted" style="font-size: 0.9rem;">The link might be invalid or expired.</p>
        <a href="/pages/p2p.html" class="btn-primary"
          style="margin-top: 2rem; background: var(--danger); color: #fff;">Try Again</a>
      </div>
    </div>
  </main>

  <!-- Transfer Overlay (Common) -->
  <div class="modal-overlay" id="transferOverlay" style="background: var(--bg);">
    <div class="modal-content" style="border: none; background: transparent; box-shadow: none;">
      <div id="transferCard">
        <div id="transferIcon"
          style="width: 64px; height: 64px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem;">
          <svg style="width: 32px; height: 32px; color: var(--text-dim);" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
              d="M7.5 7.5h-.75A2.25 2.25 0 0 0 4.5 9.75v7.5a2.25 2.25 0 0 0 2.25 2.25h7.5a2.25 2.25 0 0 0 2.25-2.25v-7.5a2.25 2.25 0 0 0-2.25-2.25h-.75m0-3-3-3m0 0-3 3m3-3v11.25m6-2.25h.75a2.25 2.25 0 0 1 2.25 2.25v7.5a2.25 2.25 0 0 1-2.25 2.25h-7.5a2.25 2.25 0 0 1-2.25-2.25v-.75" />
          </svg>
        </div>
        <div style="text-align: center; margin-bottom: 2rem;">
          <h2 id="transferName"
            style="font-size: 1.25rem; margin-bottom: 4px; overflow: hidden; text-overflow: ellipsis;">Synchronizing...
          </h2>
          <p id="transferStage" class="text-muted" style="font-size: 0.9rem;">Connecting...</p>
        </div>

        <div class="progress-container">
          <div style="display: flex; justify-content: space-between; align-items: flex-end;">
            <span id="uiPercent" style="font-size: 2rem; font-weight: 700; font-family: 'Outfit';">0%</span>
            <span id="uiEta" class="text-muted" style="font-size: 0.85rem; font-family: monospace;">--:--</span>
          </div>
          <div class="progress-track">
            <div id="transferBar" class="progress-fill"></div>
          </div>
          <div style="margin-top: 1rem; display: flex; justify-content: space-between;">
            <span id="uiSpeed" class="text-dim" style="font-size: 0.75rem; font-family: monospace;">0 MB/s</span>
            <span class="text-dim" style="font-size: 0.75rem;">End-to-End Encrypted</span>
          </div>
        </div>

        <div style="margin-top: 4rem;">
          <button id="abortBtn" onclick="abortTransfer()" class="text-dim hover:text-danger"
            style="background: transparent; width: 100%; font-weight: 500;">Cancel</button>
          <button id="successCloseBtn" onclick="closeTransferOverlay()" class="btn-primary hidden"
            style="width: 100%; justify-content: center;">Transfer Complete</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Incoming Request Modal -->
  <div class="modal-overlay" id="requestModal">
    <div class="modal-content" style="text-align: center;">
      <h3 style="margin-bottom: 0.5rem; font-size: 1.25rem;">Incoming Files</h3>
      <p id="requestInfo" class="text-muted" style="font-size: 0.85rem; margin-bottom: 2rem;">Someone wants to share
        files with you.</p>

      <div style="display: flex; gap: 1rem;">
        <button onclick="respondToTransfer(false)"
          style="flex: 1; background: transparent; color: var(--text-dim);">Decline</button>
        <button onclick="respondToTransfer(true)" class="btn-primary"
          style="flex: 2; justify-content: center;">Accept</button>
      </div>
    </div>
  </div>

  <!-- Edit Profile Modal -->
  <div class="modal-overlay" id="nameModal">
    <div class="modal-content" style="max-width: 420px;">
      <header style="margin-bottom: 2rem; text-align: center;">
        <h2 style="margin-bottom: 4px;">Edit Profile</h2>
        <p class="text-muted" style="font-size: 0.85rem;">Choose how you appear globally</p>
      </header>

      <div class="modal-profile-preview">
        <div id="previewAvatar" class="preview-avatar">ðŸ¦Š</div>
        <div id="previewName" class="preview-name">Anonymous</div>
      </div>

      <div class="premium-input-group">
        <label class="input-label" for="newNameInput">Display Name</label>
        <input type="text" id="newNameInput" maxlength="20" placeholder="Enter your name..." class="premium-input"
          oninput="updateModalPreview()">
        <span class="char-counter"><span id="nameCharCount">0</span>/20</span>
      </div>

      <div style="display: flex; gap: 1rem;">
        <button onclick="closeNameModal()"
          style="flex: 1; background: var(--surface-light); border: 1px solid var(--border); border-radius: var(--radius-md); padding: 0.85rem; color: var(--text-muted); font-size: 0.9rem; font-weight: 600;"
          class="hover:text-white">Cancel</button>
        <button onclick="saveNameFromModal()" class="btn-primary"
          style="flex: 1.5; justify-content: center; padding: 0.85rem; font-size: 0.9rem;">Update Profile</button>
      </div>
    </div>
  </div>

  <!-- Mobile Bottom Navigation -->
  <nav class="mobile-nav">
    <a href="/">
      <i class="fa-solid fa-house"></i>
      <span>Home</span>
    </a>
    <a href="/pages/lan.html">
      <i class="fa-solid fa-wifi"></i>
      <span>Nearby</span>
    </a>
    <a href="/pages/p2p.html" class="active">
      <i class="fa-solid fa-globe"></i>
      <span>Global</span>
    </a>
  </nav>

  <footer style="margin-top: 8rem; border-top: 1px solid var(--border); padding: 4rem 1.5rem; text-align: center;">
    <div style="display: flex; justify-content: center; gap: 2rem; margin-bottom: 2rem;">
      <span class="text-dim" style="font-size: 0.75rem; letter-spacing: 0.1em; text-transform: uppercase;">Built with Go
        &
        WebRTC</span>
    </div>
    <div
      style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; font-size: 0.8rem; color: var(--text-dim); margin-bottom: 2rem;">
      <i class="fa-solid fa-shield-halved" style="color: var(--success); font-size: 12px;"></i>
      End-to-End Encrypted Tunnel Active
    </div>
    <div class="text-dim" style="font-size: 0.8rem;">
      &copy; 2026 GoShare. All rights reserved.
    </div>
  </footer>

  <div id="toast"
    style="position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%) translateY(20px); z-index: 4000; background: var(--accent); color: #fff; padding: 0.5rem 1.5rem; border-radius: var(--radius-full); font-size: 0.85rem; font-weight: 500; opacity: 0; transition: all 0.3s ease;">
    Copied to clipboard
  </div>

  <style>
    @media (max-width: 600px) {
      .hidden-sm {
        display: none;
      }

      .xs-show {
        display: block !important;
      }
    }
  </style>

  <script src="/static/js/shared.js"></script>
  <script src="/static/js/p2p.js"></script>
</body>

</html>