<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
  <title>Global Sharing — GoShare</title>
  <meta name="description" content="Send files to anyone across the world with an encrypted link" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <link rel="stylesheet" href="/static/css/shared.css" />
  <link rel="stylesheet" href="/static/css/p2p.css" />
</head>

<body>
  <div class="grain-overlay"></div>
  <div class="ambient-light"></div>

  <!-- Navbar -->
  <nav class="nav-container">
    <a href="/" class="logo-link">
      <span>GoShare</span>
    </a>

    <div class="nav-switcher">
      <a href="/pages/lan.html">Nearby</a>
      <a href="/pages/p2p.html" class="active">Global</a>
    </div>

    <button onclick="changeName()"
      style="margin-left: auto; display: flex; align-items: center; gap: 0.75rem; background: transparent; padding: 4px 8px; border-radius: var(--radius-md); transition: background 0.2s;"
      class="hover:bg-white/5">
      <div class="text-right hidden-sm">
        <div id="navUserName" style="font-size: 0.85rem; font-weight: 600; color: #fff;">...</div>
        <div
          style="font-size: 0.7rem; color: var(--success); font-weight: 500; display: flex; align-items: center; justify-content: flex-end; gap: 0.25rem;">
          Connected
          <svg width="8" height="8" viewBox="0 0 24 24" fill="currentColor">
            <circle cx="12" cy="12" r="10" />
          </svg>
        </div>
      </div>
      <div style="position: relative;">
        <div id="navUserIcon"
          style="width: 36px; height: 36px; background: var(--surface-light); border: 1px solid var(--border); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1rem;">
        </div>
        <div
          style="position: absolute; bottom: -2px; right: -2px; width: 14px; height: 14px; background: #222; border: 1.5px solid var(--bg); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: var(--text-muted); box-shadow: 0 2px 4px rgba(0,0,0,0.5);">
          <svg width="8" height="8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"
            stroke-linecap="round" stroke-linejoin="round">
            <path
              d="M12.22 2h-.44a2 2 0 0 0-2 2a2.01 2.01 0 0 1-2 2a2 2 0 0 0-2 2a2.01 2.01 0 0 1-2 2a2.01 2.01 0 0 1-2 2a2 2 0 0 0-2 2v.44a2 2 0 0 0 2 2a2.01 2.01 0 0 1 2 2a2 2 0 0 0 2 2a2.01 2.01 0 0 1 2 2a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2a2.01 2.01 0 0 1 2-2a2 2 0 0 0 2-2a2.01 2.01 0 0 1 2-2a2 2 0 0 0 2-2v-.44a2 2 0 0 0-2-2a2.01 2.01 0 0 1-2-2a2 2 0 0 0-2-2a2.01 2.01 0 0 1-2-2a2 2 0 0 0-2-2z" />
            <circle cx="12" cy="12" r="3" />
          </svg>
        </div>
      </div>
    </button>
  </nav>

  <!-- Main Content -->
  <main class="content-section app-entrance" style="text-align: center; max-width: 600px;">

    <!-- SENDER VIEW -->
    <div id="senderView">
      <header style="margin-bottom: 3rem;">
        <div
          style="display: inline-block; padding: 0.4rem 1rem; background: var(--surface-light); border: 1px solid var(--border); border-radius: var(--radius-full); font-size: 0.75rem; color: var(--text-dim); margin-bottom: 1.5rem;">
          Sharing as <span id="userNameDisplay" style="color: #fff; font-weight: 600;">...</span>
        </div>
        <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem;">Share Everywhere</h1>
        <p class="text-muted" style="font-weight: 400;">Send files to anyone in the world with a secure link</p>
      </header>

      <div class="drop-zone" id="fileSelectArea" onclick="document.getElementById('fileInput').click()">
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
          style="margin-bottom: 1rem;">
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4M17 8l-5-5-5 5M12 3v12" />
        </svg>
        <div style="font-size: 1.1rem; font-weight: 600; margin-bottom: 4px;">Choose Files</div>
        <p class="text-dim" style="font-size: 0.85rem;">Drag and drop files here to start</p>
        </header>
        <input type="file" id="fileInput" multiple style="display: none;" />

        <div id="selectedFile" class="hidden" style="margin-top: 2rem;">
          <div id="fileList"
            style="margin-bottom: 2rem; border: 1px solid var(--border); border-radius: var(--radius-md); background: var(--surface); padding: 1rem; max-height: 200px; overflow-y: auto;">
          </div>
          <button id="shareBtn" onclick="createRoom()" class="btn-primary"
            style="width: 100%; justify-content: center;">Create Secure Link</button>
        </div>

        <!-- Share Info -->
        <div id="shareInfo" class="hidden" style="margin-top: 2rem;">
          <div
            style="background: var(--surface); border: 1px solid var(--border); border-radius: var(--radius-lg); padding: 2.5rem; box-shadow: var(--shadow-lg);">
            <div id="qrcode"
              style="background: #fff; padding: 1.5rem; border-radius: var(--radius-md); display: inline-block; margin-bottom: 2rem;">
            </div>

            <div
              style="display: flex; background: var(--bg); border: 1px solid var(--border); border-radius: var(--radius-full); padding: 4px 4px 4px 1.25rem; align-items: center; gap: 1rem; margin-bottom: 2rem;">
              <span id="shareUrl" class="text-muted"
                style="font-family: monospace; font-size: 0.8rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; flex: 1;">Loading...</span>
              <button onclick="copyLink()" class="btn-primary"
                style="padding: 0.5rem 1.25rem; font-size: 0.8rem;">Copy</button>
            </div>

            <div id="waitingStatus"
              style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; font-size: 0.85rem; color: var(--text-dim);">
              <div
                style="width: 6px; height: 6px; border-radius: 50%; background: var(--accent); animation: pulse 2s infinite;">
              </div>
              Waiting for recipient...
            </div>
          </div>
        </div>
      </div>

      <!-- RECEIVER VIEW -->
      <div id="receiverView" class="hidden">
        <header style="margin-bottom: 3rem;">
          <div
            style="display: inline-block; padding: 0.4rem 1rem; background: var(--surface-light); border: 1px solid var(--border); border-radius: var(--radius-full); font-size: 0.75rem; color: var(--text-dim); margin-bottom: 1.5rem;">
            From: <span id="remoteUserName" style="color: #fff; font-weight: 600;">Someone</span>
          </div>
          <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem;">Secure Transfer</h1>
          <p class="text-muted" style="font-weight: 400;">Encrypted direct connection established</p>
        </header>

        <div id="recvDefault"
          style="background: var(--surface); border: 1px solid var(--border); padding: 2.5rem; border-radius: var(--radius-lg); text-align: center;">
          <div style="color: var(--accent); margin-bottom: 1.25rem;">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
              <polyline points="7 10 12 15 17 10" />
              <line x1="12" y1="15" x2="12" y2="3" />
            </svg>
          </div>
          <p id="receiverFilesText" style="font-weight: 600; margin-bottom: 0.75rem; font-size: 1.1rem;">Files ready to
            download</p>
          <div id="receiverStatus"
            style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; font-size: 0.85rem; color: var(--success);">
            <div style="width: 6px; height: 6px; border-radius: 50%; background: currentColor;"></div>
            Stable Connection
          </div>
        </div>

        <div id="recvConnecting" class="hidden" style="padding: 4rem 2rem;">
          <div style="font-size: 2rem; animation: pulse 1s infinite;">⚡</div>
          <p class="text-muted" style="margin-top: 1rem;">Connecting to sender...</p>
        </div>

        <div id="recvError" class="hidden"
          style="background: rgba(239, 68, 68, 0.05); border: 1px solid var(--danger); padding: 3rem; border-radius: var(--radius-lg);">
          <h3 style="color: var(--danger); margin-bottom: 1rem;">Connection Failed</h3>
          <p id="recvErrorMsg" class="text-muted" style="font-size: 0.9rem;">The link might be invalid or expired.</p>
          <a href="/pages/p2p.html" class="btn-primary"
            style="margin-top: 2rem; background: var(--danger); color: #fff;">Try Again</a>
        </div>
      </div>
  </main>

  <!-- Transfer Overlay (Common) -->
  <div class="modal-overlay" id="transferOverlay" style="background: var(--bg);">
    <div class="modal-content" style="border: none; background: transparent; box-shadow: none;">
      <div id="transferCard">
        <div style="text-align: center; margin-bottom: 2rem;">
          <h2 id="transferName"
            style="font-size: 1.25rem; margin-bottom: 4px; overflow: hidden; text-overflow: ellipsis;">Synchronizing...
          </h2>
          <p id="transferStage" class="text-muted" style="font-size: 0.9rem;">Connecting...</p>
        </div>

        <div class="progress-container">
          <div style="display: flex; justify-content: space-between; align-items: flex-end;">
            <span id="uiPercent" style="font-size: 2rem; font-weight: 700; font-family: 'Outfit';">0%</span>
            <span id="uiEta" class="text-muted" style="font-size: 0.85rem; font-family: monospace;">--:--</span>
          </div>
          <div class="progress-track">
            <div id="transferBar" class="progress-fill"></div>
          </div>
          <div style="margin-top: 1rem; display: flex; justify-content: space-between;">
            <span id="uiSpeed" class="text-dim" style="font-size: 0.75rem; font-family: monospace;">0 MB/s</span>
            <span class="text-dim" style="font-size: 0.75rem;">End-to-End Encrypted</span>
          </div>
        </div>

        <div style="margin-top: 4rem;">
          <button id="abortBtn" onclick="abortTransfer()" class="text-dim hover:text-danger"
            style="background: transparent; width: 100%; font-weight: 500;">Cancel</button>
          <button id="successCloseBtn" onclick="closeTransferOverlay()" class="btn-primary hidden"
            style="width: 100%; justify-content: center;">Transfer Complete</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Incoming Request Modal -->
  <div class="modal-overlay" id="requestModal">
    <div class="modal-content" style="text-align: center;">
      <h3 style="margin-bottom: 0.5rem; font-size: 1.25rem;">Incoming Files</h3>
      <p id="requestInfo" class="text-muted" style="font-size: 0.85rem; margin-bottom: 2rem;">Someone wants to share
        files with you.</p>

      <div style="display: flex; gap: 1rem;">
        <button onclick="respondToTransfer(false)"
          style="flex: 1; background: transparent; color: var(--text-dim);">Decline</button>
        <button onclick="respondToTransfer(true)" class="btn-primary"
          style="flex: 2; justify-content: center;">Accept</button>
      </div>
    </div>
  </div>

  <!-- Identity Modal -->
  <div class="modal-overlay" id="nameModal">
    <div class="modal-content">
      <h2 style="margin-bottom: 0.5rem; font-size: 1.25rem;">Set Display Name</h2>
      <p class="text-muted" style="font-size: 0.75rem; margin-bottom: 1.5rem;">Choose how you appear to others</p>

      <input type="text" id="newNameInput" maxlength="20" placeholder="Enter name..."
        style="width: 100%; background: var(--bg); border: 1px solid var(--border); padding: 1rem 1.5rem; border-radius: var(--radius-md); color: #fff; margin-bottom: 2rem; outline: none; font-size: 1rem;">

      <div style="display: flex; gap: 0.75rem;">
        <button onclick="closeNameModal()"
          style="flex: 1; background: transparent; color: var(--text-dim); font-size: 0.85rem;">Cancel</button>
        <button onclick="saveNameFromModal()" class="btn-primary" style="flex: 2; justify-content: center;">Save
          Name</button>
      </div>
    </div>
  </div>

  <footer style="margin-top: 8rem; border-top: 1px solid var(--border); padding: 4rem 1.5rem; text-align: center;">
    <div style="display: flex; justify-content: center; gap: 2rem; margin-bottom: 2rem;">
      <span class="text-dim" style="font-size: 0.75rem; letter-spacing: 0.1em; text-transform: uppercase;">Built with Go
        &
        WebRTC</span>
    </div>
    <div
      style="display: flex; align-items: center; justify-content: center; gap: 0.5rem; font-size: 0.8rem; color: var(--text-dim); margin-bottom: 2rem;">
      <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="var(--success)" stroke-width="3">
        <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
      </svg>
      End-to-End Encrypted Tunnel Active
    </div>
    <div class="text-dim" style="font-size: 0.8rem;">
      &copy; 2026 GoShare. All rights reserved.
    </div>
  </footer>

  <div id="toast"
    style="position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%) translateY(20px); z-index: 4000; background: var(--accent); color: #fff; padding: 0.5rem 1.5rem; border-radius: var(--radius-full); font-size: 0.85rem; font-weight: 500; opacity: 0; transition: all 0.3s ease;">
    Copied to clipboard
  </div>

  <style>
    @media (max-width: 600px) {
      .hidden-sm {
        display: none;
      }

      .xs-show {
        display: block !important;
      }
    }
  </style>

  <script src="/static/js/shared.js"></script>
  <script src="/static/js/p2p.js"></script>
</body>

</html>