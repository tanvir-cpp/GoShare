<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
  <title>Nearby Sharing â€” GoShare</title>
  <meta name="description" content="Share files instantly with devices on your local network" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸš€</text></svg>">
  <link rel="stylesheet" href="/static/css/shared.css" />
  <link rel="stylesheet" href="/static/css/lan.css" />
  <style>
    #sharedFileList:empty+#sharedSendBtn {
      display: none;
    }
  </style>
</head>

<body>
  <div class="grain-overlay"></div>
  <div class="ambient-light"></div>

  <!-- Navbar -->
  <nav class="nav-container">
    <a href="/" class="logo-link">
      <span>GoShare</span>
    </a>

    <div class="nav-switcher">
      <a href="/pages/lan.html" class="active">Nearby</a>
      <a href="/pages/p2p.html">Global</a>
    </div>

    <button onclick="changeName()" class="nav-profile-btn" title="Edit profile">
      <span id="navUserIcon" class="nav-profile-emoji skeleton"></span>
      <span id="navUserName" class="nav-profile-name skeleton">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>
      <i class="fa-solid fa-pen nav-profile-edit"></i>
    </button>
  </nav>

  <!-- Main Content -->
  <main class="content-section app-entrance" style="text-align: center;">
    <header style="margin-bottom: 3rem;">
      <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem;">Nearby Sharing</h1>
      <p class="text-muted" style="font-weight: 400;" aria-live="polite">Share files with anyone on your local network
      </p>
    </header>

    <!-- Radar Area -->
    <div class="device-radar" id="deviceArea">
      <div class="radar-sweep"></div>
      <div class="radar-circle circle-1"></div>
      <div class="radar-circle circle-2"></div>
      <div class="radar-circle circle-3"></div>

      <div onclick="openSharedUpload()" class="me-center app-entrance">
        <div id="meIcon" class="me-icon"></div>
        <div id="meName" class="hidden"></div>
        <span class="me-label">You</span>
      </div>
      <div id="emptyState" class="text-center"
        style="position: absolute; width: 100%; top: 65%; transform: translateY(-50%);">
        <div class="text-muted" style="font-size: 0.95rem; font-weight: 500;">Searching for nearby devices...</div>
      </div>
    </div>

    <div class="text-center" style="margin-bottom: 1rem;">
      <div id="deviceCount" aria-live="polite"
        style="padding: 0.4rem 1rem; background: var(--surface-light); border: 1px solid var(--border); border-radius: var(--radius-full); font-size: 0.75rem; color: var(--text-dim); display: inline-block;">
        Searching...
      </div>
    </div>
    <p class="text-dim" style="font-size: 0.85rem; text-align: center;">Tap a device to send files â€¢ Drag & drop also
      works</p>

    <div style="margin-top: 3.5rem; text-align: center;">
      <button onclick="openConnectModal()"
        style="padding: 0.75rem 1.75rem; background: rgba(255, 255, 255, 0.03); border: 1px solid var(--border); border-radius: var(--radius-full); font-size: 0.85rem; color: #fff; display: inline-flex; align-items: center; gap: 0.75rem; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);"
        class="hover:border-white/20 hover:bg-white/5">
        <i class="fa-solid fa-link" style="font-size: 14px;"></i>
        <span>Connect with Link or QR</span>
      </button>
    </div>
  </main>

  <!-- Fixed Bottom Bar -->
  <div class="shared-bar" id="sharedBar">
    <!-- File chips will be dynamically added here -->
  </div>

  <button onclick="openSharedUpload()" class="action-fab">
    <i class="fa-solid fa-plus" style="font-size: 18px;"></i>
    <span>Share Files</span>
  </button>

  <!-- Modals -->

  <!-- Send File Modal -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal-content">
      <header style="text-align: center; margin-bottom: 1rem;">
        <h2 id="modalName" style="font-size: 1.25rem; margin-bottom: 2px;">Send Files</h2>
        <p class="text-muted" style="font-size: 0.75rem;">Your files will be sent directly</p>
      </header>

      <div class="drop-zone" id="modalDropArea">
        <i class="fa-solid fa-cloud-arrow-up" style="font-size: 32px; margin-bottom: 1rem; color: var(--text-dim);"></i>
        <div style="font-weight: 500; margin-bottom: 4px;">Choose files</div>
        <div class="text-dim" style="font-size: 0.75rem;">or drag and drop here</div>
      </div>

      <div id="modalFileList" style="margin-bottom: 1rem; max-height: 120px; overflow-y: auto;"></div>

      <div style="display: flex; flex-direction: column; gap: 0.5rem;">
        <button id="modalSendBtn" onclick="startLanUpload()" class="btn-primary hidden"
          style="justify-content: center;">Send Now</button>
        <button onclick="closeModal()" class="text-dim hover:text-white"
          style="background: transparent; font-size: 0.8rem; padding: 0.5rem;">Cancel</button>
      </div>
      <input type="file" id="modalFileInput" multiple class="hidden" style="display: none;" />
    </div>
  </div>

  <!-- Transfer Progress -->
  <div class="modal-overlay" id="transferOverlay" style="background: var(--bg);">
    <div class="modal-content" style="border: none; background: transparent; box-shadow: none;">
      <div id="transferCard">
        <div id="transferIcon"
          style="width: 64px; height: 64px; background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem;">
          <svg style="width: 32px; height: 32px; color: var(--text-dim);" fill="none" viewBox="0 0 24 24"
            stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5"
              d="M7.5 7.5h-.75A2.25 2.25 0 0 0 4.5 9.75v7.5a2.25 2.25 0 0 0 2.25 2.25h7.5a2.25 2.25 0 0 0 2.25-2.25v-7.5a2.25 2.25 0 0 0-2.25-2.25h-.75m0-3-3-3m0 0-3 3m3-3v11.25m6-2.25h.75a2.25 2.25 0 0 1 2.25 2.25v7.5a2.25 2.25 0 0 1-2.25 2.25h-7.5a2.25 2.25 0 0 1-2.25-2.25v-.75" />
          </svg>
        </div>
        <div style="text-align: center; margin-bottom: 1.5rem;">
          <h2 id="transferName"
            style="font-size: 1.25rem; margin-bottom: 4px; overflow: hidden; text-overflow: ellipsis;">Sending...</h2>
          <p id="transferStage" class="text-muted" style="font-size: 0.9rem;" aria-live="polite">Starting transfer</p>
        </div>

        <div class="progress-container">
          <div style="display: flex; justify-content: space-between; align-items: flex-end;">
            <span id="uiPercent" style="font-size: 2rem; font-weight: 700; font-family: 'Outfit';">0%</span>
            <span id="uiEta" class="text-muted" style="font-size: 0.85rem; font-family: monospace;">--:--</span>
          </div>
          <div class="progress-track">
            <div id="transferBar" class="progress-fill"></div>
          </div>
          <div style="margin-top: 1rem; display: flex; justify-content: space-between;">
            <span id="uiSpeed" class="text-dim" style="font-size: 0.75rem; font-family: monospace;">0 MB/s</span>
            <span class="text-dim" style="font-size: 0.75rem;">Encrypted Tunnel</span>
          </div>
        </div>

        <div style="margin-top: 2.5rem;">
          <button id="abortBtn" onclick="abortTransfer()" class="text-dim hover:text-danger"
            style="background: transparent; width: 100%; font-weight: 500;">Cancel Transfer</button>
          <button id="successCloseBtn" onclick="closeTransferOverlay()" class="btn-primary hidden"
            style="width: 100%; justify-content: center;">Done</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Shared Files Modal -->
  <div class="modal-overlay" id="sharedOverlay">
    <div class="modal-content">
      <header style="text-align: center; margin-bottom: 1rem;">
        <h2 style="font-size: 1.25rem; margin-bottom: 2px;">Public Shared Space</h2>
        <p class="text-muted" style="font-size: 0.75rem;">Anyone nearby can see and download these files</p>
      </header>

      <div class="drop-zone" id="sharedDropArea">
        <i class="fa-solid fa-cloud-arrow-up" style="font-size: 32px; margin-bottom: 1rem; color: var(--text-dim);"></i>
        <div style="font-weight: 500; margin-bottom: 4px;">Choose files</div>
        <div class="text-dim" style="font-size: 0.75rem;">or drag and drop here</div>
      </div>

      <div id="sharedFileList" style="margin-top: 1rem; margin-bottom: 1.5rem; max-height: 250px; overflow-y: auto;">
      </div>

      <div style="display: flex; flex-direction: column; gap: 0.75rem;">
        <button id="sharedSendBtn" onclick="startLanUpload(true)" class="btn-primary hidden"
          style="justify-content: center;">Upload Now</button>
        <button onclick="closeSharedOverlay()" class="text-dim hover:text-white"
          style="background: transparent; font-size: 0.9rem;">Cancel</button>
      </div>
      <input type="file" id="sharedFileInput" multiple class="hidden" style="display: none;" />
    </div>
  </div>

  <!-- Request Modal -->
  <div class="modal-overlay" id="lanRequestModal">
    <div class="modal-content" style="text-align: center;">
      <h3 style="margin-bottom: 0.5rem; font-size: 1.25rem;">Incoming Transfer</h3>
      <p id="lanRequestInfo" class="text-muted" style="font-size: 0.85rem; margin-bottom: 2rem;">Someone wants to send
        you a file...</p>

      <div style="display: flex; gap: 1rem;">
        <button onclick="respondToLan(false)" class="text-dim hover:text-white"
          style="flex: 1; background: transparent; padding: 0.75rem;">Decline</button>
        <button onclick="respondToLan(true)" class="btn-primary"
          style="flex: 2; justify-content: center;">Accept</button>
      </div>
    </div>
  </div>

  <!-- QR Modal -->
  <div class="modal-overlay" id="connectModal">
    <div class="modal-content" style="text-align: center; max-width: 360px;">
      <h2 style="margin-bottom: 0.5rem;">Connect Device</h2>
      <p class="text-muted" style="font-size: 0.85rem; margin-bottom: 2rem;">Scan the QR or copy the link to connect
        instantly</p>

      <div id="lanQr"
        style="background: #fff; padding: 1.5rem; border-radius: var(--radius-md); display: inline-block; margin-bottom: 2rem;">
      </div>

      <div onclick="copyConnectUrl()"
        style="background: var(--surface-light); border: 1px solid var(--border); padding: 0.75rem 1rem; border-radius: var(--radius-md); font-family: monospace; font-size: 0.8rem; color: var(--text-muted); cursor: pointer; margin-bottom: 2rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"
        id="lanUrlText">
        Loading link...
      </div>

      <button onclick="closeConnectModal()" class="text-dim hover:text-white"
        style="background: transparent; width: 100%;">Close</button>
    </div>
  </div>

  <!-- Edit Profile Modal -->
  <div class="modal-overlay" id="nameModal">
    <div class="modal-content" style="max-width: 420px;">
      <header style="margin-bottom: 2rem; text-align: center;">
        <h2 style="margin-bottom: 4px;">Edit Profile</h2>
        <p class="text-muted" style="font-size: 0.85rem;">Personalize your identity on the network</p>
      </header>

      <div class="modal-profile-preview">
        <div id="previewAvatar" class="preview-avatar">ðŸ¦Š</div>
        <div id="previewName" class="preview-name">Anonymous</div>
      </div>

      <div class="premium-input-group">
        <label class="input-label" for="newNameInput">Display Name</label>
        <input type="text" id="newNameInput" maxlength="20" placeholder="Enter your name..." class="premium-input"
          oninput="updateModalPreview()">
        <span class="char-counter"><span id="nameCharCount">0</span>/20</span>
      </div>

      <div style="display: flex; gap: 1rem;">
        <button onclick="closeNameModal()"
          style="flex: 1; background: var(--surface-light); border: 1px solid var(--border); border-radius: var(--radius-md); padding: 0.85rem; color: var(--text-muted); font-size: 0.9rem; font-weight: 600;"
          class="hover:text-white">Cancel</button>
        <button onclick="saveNameFromModal()" class="btn-primary"
          style="flex: 1.5; justify-content: center; padding: 0.85rem; font-size: 0.9rem;">Update Profile</button>
      </div>
    </div>
  </div>

  <!-- Notifications & Toasts -->
  <div id="notif"
    style="position: fixed; top: 1rem; right: 1rem; z-index: 3000; background: var(--surface-light); border: 1px solid var(--border); padding: 1.5rem; border-radius: var(--radius-md); width: 300px; box-shadow: var(--shadow-lg); opacity: 0; pointer-events: none; transition: all 0.3s ease; transform: translateY(-20px);">
    <button onclick="closeNotif()"
      style="position: absolute; top: 0.75rem; right: 0.75rem; background: transparent; color: var(--text-dim); font-size: 1.25rem; line-height: 1;">&times;</button>
    <div style="font-weight: 600; font-size: 0.9rem; margin-bottom: 4px;" id="notifTitle">New File Received</div>
    <p id="notifSub"
      style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 1.5rem; overflow: hidden; text-overflow: ellipsis;">
      filename.ext</p>
    <button onclick="downloadNotifFile()" class="btn-primary"
      style="width: 100%; justify-content: center; font-size: 0.85rem;">Download</button>
  </div>

  <div id="toast"
    style="position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%) translateY(20px); z-index: 4000; background: var(--accent); color: #fff; padding: 0.5rem 1.5rem; border-radius: var(--radius-full); font-size: 0.85rem; font-weight: 500; opacity: 0; transition: all 0.3s ease;">
    Copied to clipboard
  </div>

  <style>
    @media (max-width: 600px) {
      .hidden-sm {
        display: none;
      }

      .xs-show {
        display: block !important;
      }
    }
  </style>

  <!-- Mobile Bottom Navigation -->
  <nav class="mobile-nav">
    <a href="/">
      <i class="fa-solid fa-house"></i>
      <span>Home</span>
    </a>
    <a href="/pages/lan.html" class="active">
      <i class="fa-solid fa-wifi"></i>
      <span>Nearby</span>
    </a>
    <a href="/pages/p2p.html">
      <i class="fa-solid fa-globe"></i>
      <span>Global</span>
    </a>
  </nav>

  <footer style="margin-top: 8rem; border-top: 1px solid var(--border); padding: 4rem 1.5rem; text-align: center;">

    <div class="text-dim" style="font-size: 0.8rem;">
      &copy; 2026 GoShare. All rights reserved.
    </div>
  </footer>

  <script src="/static/js/shared.js"></script>
  <script src="/static/js/app.js"></script>
</body>

</html>