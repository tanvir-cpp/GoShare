<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0" />
  <title>Nearby Sharing â€” GoShare</title>
  <meta name="description" content="Share files instantly with devices on your local network" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <link rel="stylesheet" href="/static/css/shared.css" />
  <link rel="stylesheet" href="/static/css/lan.css" />
</head>

<body>
  <div class="grain-overlay"></div>
  <div class="ambient-light"></div>

  <!-- Navbar -->
  <nav class="nav-container">
    <a href="/" class="logo-link">
      <span>GoShare</span>
    </a>

    <div class="nav-switcher">
      <a href="/pages/lan.html" class="active">Nearby</a>
      <a href="/pages/p2p.html">Global</a>
    </div>

    <button onclick="changeName()"
      style="margin-left: auto; display: flex; align-items: center; gap: 0.75rem; background: rgba(255, 255, 255, 0.02); border: 1px solid var(--border); padding: 5px 6px 5px 12px; border-radius: var(--radius-full); transition: all 0.3s ease;"
      class="hover:border-white/20 hover:bg-white/5">
      <div class="text-right hidden-sm">
        <div id="navUserName" style="font-size: 0.85rem; font-weight: 600; color: #fff;">...</div>
        <div
          style="font-size: 0.7rem; color: var(--success); font-weight: 500; display: flex; align-items: center; justify-content: flex-end; gap: 0.25rem;">
          Online
          <i class="fa-solid fa-circle" style="font-size: 8px; opacity: 0.8;"></i>
        </div>
      </div>
      <div style="position: relative;">
        <div id="navUserIcon"
          style="width: 36px; height: 36px; background: var(--surface-light); border: 1px solid var(--border); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1rem;">
        </div>
        <div
          style="position: absolute; bottom: -2px; right: -2px; width: 14px; height: 14px; background: var(--accent); border: 1.5px solid var(--bg); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.5);">
          <svg width="8" height="8" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"
            stroke-linecap="round" stroke-linejoin="round">
            <path
              d="M12.22 2h-.44a2 2 0 0 0-2 2a2.01 2.01 0 0 1-2 2a2 2 0 0 0-2 2a2.01 2.01 0 0 1-2 2a2 2 0 0 0-2 2v.44a2 2 0 0 0 2 2a2.01 2.01 0 0 1 2 2a2 2 0 0 0 2 2a2.01 2.01 0 0 1 2 2a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2a2.01 2.01 0 0 1 2-2a2 2 0 0 0 2-2a2.01 2.01 0 0 1 2-2a2 2 0 0 0 2-2v-.44a2 2 0 0 0-2-2a2.01 2.01 0 0 1-2-2a2 2 0 0 0-2-2a2.01 2.01 0 0 1-2-2a2 2 0 0 0-2-2z" />
            <circle cx="12" cy="12" r="3" />
          </svg>
        </div>
      </div>
    </button>
  </nav>

  <!-- Main Content -->
  <main class="content-section app-entrance" style="text-align: center;">
    <header style="margin-bottom: 3rem;">
      <h1 style="font-size: 2.5rem; margin-bottom: 0.5rem;">Nearby Sharing</h1>
      <p class="text-muted" style="font-weight: 400;">Share files with anyone on your local network</p>
    </header>

    <!-- Radar Area -->
    <div class="device-radar" id="deviceArea">
      <div class="radar-sweep"></div>
      <div class="radar-circle circle-1"></div>
      <div class="radar-circle circle-2"></div>
      <div class="radar-circle circle-3"></div>

      <div onclick="openSharedUpload()" class="me-center app-entrance">
        <div id="meIcon" class="me-icon"></div>
        <div id="meName" class="hidden"></div>
        <span class="me-label">You</span>
      </div>
      <div id="emptyState" class="text-center"
        style="position: absolute; width: 100%; top: 65%; transform: translateY(-50%);">
        <div class="text-muted" style="font-size: 0.85rem;">Searching for nearby devices...</div>
      </div>
    </div>

    <div class="text-center" style="margin-bottom: 1rem;">
      <div id="deviceCount"
        style="padding: 0.4rem 1rem; background: var(--surface-light); border: 1px solid var(--border); border-radius: var(--radius-full); font-size: 0.75rem; color: var(--text-dim); display: inline-block;">
        Searching...
      </div>
    </div>
    <p class="text-dim" style="font-size: 0.85rem; text-align: center;">Devices running GoShare will appear here</p>

    <div style="margin-top: 3.5rem; text-align: center;">
      <button onclick="openConnectModal()"
        style="padding: 0.75rem 1.75rem; background: rgba(255, 255, 255, 0.03); border: 1px solid var(--border); border-radius: var(--radius-full); font-size: 0.85rem; color: #fff; display: inline-flex; align-items: center; gap: 0.75rem; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);"
        class="hover:border-white/20 hover:bg-white/5">
        <i class="fa-solid fa-link" style="font-size: 14px;"></i>
        <span>Connect with Link or QR</span>
      </button>
    </div>
  </main>

  <!-- Fixed Bottom Bar -->
  <div class="shared-bar" id="sharedBar">
    <!-- File chips will be dynamically added here -->
  </div>

  <button onclick="openSharedUpload()" class="action-fab">
    <i class="fa-solid fa-plus" style="font-size: 18px;"></i>
    <span>Share Files</span>
  </button>

  <!-- Modals -->

  <!-- Send File Modal -->
  <div class="modal-overlay" id="modalOverlay">
    <div class="modal-content">
      <header style="text-align: center; margin-bottom: 1rem;">
        <h2 id="modalName" style="font-size: 1.25rem; margin-bottom: 2px;">Send Files</h2>
        <p class="text-muted" style="font-size: 0.75rem;">Your files will be sent directly</p>
      </header>

      <div class="drop-zone" id="modalDropArea">
        <i class="fa-solid fa-cloud-arrow-up" style="font-size: 32px; margin-bottom: 1rem; color: var(--text-dim);"></i>
        <div style="font-weight: 500; margin-bottom: 4px;">Choose files</div>
        <div class="text-dim" style="font-size: 0.75rem;">or drag and drop here</div>
      </div>

      <div id="modalFileList" style="margin-bottom: 1rem; max-height: 120px; overflow-y: auto;"></div>

      <div style="display: flex; flex-direction: column; gap: 0.5rem;">
        <button id="modalSendBtn" onclick="startLanUpload()" class="btn-primary hidden"
          style="justify-content: center;">Send Now</button>
        <button onclick="closeModal()" class="text-dim hover:text-white"
          style="background: transparent; font-size: 0.8rem; padding: 0.5rem;">Cancel</button>
      </div>
      <input type="file" id="modalFileInput" multiple class="hidden" style="display: none;" />
    </div>
  </div>

  <!-- Transfer Progress -->
  <div class="modal-overlay" id="transferOverlay" style="background: var(--bg);">
    <div class="modal-content" style="border: none; background: transparent; box-shadow: none;">
      <div id="transferCard">
        <div style="text-align: center; margin-bottom: 1.5rem;">
          <h2 id="transferName"
            style="font-size: 1.25rem; margin-bottom: 4px; overflow: hidden; text-overflow: ellipsis;">Sending...</h2>
          <p id="transferStage" class="text-muted" style="font-size: 0.9rem;">Starting transfer</p>
        </div>

        <div class="progress-container">
          <div style="display: flex; justify-content: space-between; align-items: flex-end;">
            <span id="uiPercent" style="font-size: 2rem; font-weight: 700; font-family: 'Outfit';">0%</span>
            <span id="uiEta" class="text-muted" style="font-size: 0.85rem; font-family: monospace;">--:--</span>
          </div>
          <div class="progress-track">
            <div id="transferBar" class="progress-fill"></div>
          </div>
          <div style="margin-top: 1rem; display: flex; justify-content: space-between;">
            <span id="uiSpeed" class="text-dim" style="font-size: 0.75rem; font-family: monospace;">0 MB/s</span>
            <span class="text-dim" style="font-size: 0.75rem;">Encrypted Tunnel</span>
          </div>
        </div>

        <div style="margin-top: 2.5rem;">
          <button id="abortBtn" onclick="abortTransfer()" class="text-dim hover:text-danger"
            style="background: transparent; width: 100%; font-weight: 500;">Cancel Transfer</button>
          <button id="successCloseBtn" onclick="closeTransferOverlay()" class="btn-primary hidden"
            style="width: 100%; justify-content: center;">Done</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Shared Files Modal -->
  <div class="modal-overlay" id="sharedOverlay">
    <div class="modal-content">
      <header style="text-align: center; margin-bottom: 1rem;">
        <h2 style="font-size: 1.25rem; margin-bottom: 2px;">Public Shared Space</h2>
        <p class="text-muted" style="font-size: 0.75rem;">Anyone nearby can see and download these files</p>
      </header>

      <div class="drop-zone" id="sharedDropArea">
        <i class="fa-solid fa-cloud-arrow-up" style="font-size: 32px; margin-bottom: 1rem; color: var(--text-dim);"></i>
        <div style="font-weight: 500; margin-bottom: 4px;">Choose files</div>
        <div class="text-dim" style="font-size: 0.75rem;">or drag and drop here</div>
      </div>

      <div id="sharedFileList" style="margin-bottom: 1.5rem; max-height: 150px; overflow-y: auto;"></div>

      <div style="display: flex; flex-direction: column; gap: 0.75rem;">
        <button id="sharedSendBtn" onclick="startLanUpload(true)" class="btn-primary hidden"
          style="justify-content: center;">Upload Now</button>
        <button onclick="closeSharedOverlay()" class="text-dim hover:text-white"
          style="background: transparent; font-size: 0.9rem;">Cancel</button>
      </div>
      <input type="file" id="sharedFileInput" multiple class="hidden" style="display: none;" />
    </div>
  </div>

  <!-- Request Modal -->
  <div class="modal-overlay" id="lanRequestModal">
    <div class="modal-content" style="text-align: center;">
      <h3 style="margin-bottom: 0.5rem; font-size: 1.25rem;">Incoming Transfer</h3>
      <p id="lanRequestInfo" class="text-muted" style="font-size: 0.85rem; margin-bottom: 2rem;">Someone wants to send
        you a file...</p>

      <div style="display: flex; gap: 1rem;">
        <button onclick="respondToLan(false)" class="text-dim hover:text-white"
          style="flex: 1; background: transparent; padding: 0.75rem;">Decline</button>
        <button onclick="respondToLan(true)" class="btn-primary"
          style="flex: 2; justify-content: center;">Accept</button>
      </div>
    </div>
  </div>

  <!-- QR Modal -->
  <div class="modal-overlay" id="connectModal">
    <div class="modal-content" style="text-align: center; max-width: 360px;">
      <h2 style="margin-bottom: 0.5rem;">Connect Device</h2>
      <p class="text-muted" style="font-size: 0.85rem; margin-bottom: 2rem;">Scan the QR or copy the link to connect
        instantly</p>

      <div id="lanQr"
        style="background: #fff; padding: 1.5rem; border-radius: var(--radius-md); display: inline-block; margin-bottom: 2rem;">
      </div>

      <div onclick="copyConnectUrl()"
        style="background: var(--surface-light); border: 1px solid var(--border); padding: 0.75rem 1rem; border-radius: var(--radius-md); font-family: monospace; font-size: 0.8rem; color: var(--text-muted); cursor: pointer; margin-bottom: 2rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;"
        id="lanUrlText">
        Loading link...
      </div>

      <button onclick="closeConnectModal()" class="text-dim hover:text-white"
        style="background: transparent; width: 100%;">Close</button>
    </div>
  </div>

  <!-- Name Modal -->
  <div class="modal-overlay" id="nameModal">
    <div class="modal-content">
      <h2 style="margin-bottom: 0.5rem;">Edit Profile</h2>
      <p class="text-muted" style="font-size: 0.85rem; margin-bottom: 2rem;">Choose how you appear to others on the
        network</p>

      <input type="text" id="newNameInput" maxlength="20" placeholder="Enter name..."
        style="width: 100%; background: var(--bg); border: 1px solid var(--border); padding: 1rem 1.5rem; border-radius: var(--radius-md); color: #fff; margin-bottom: 2rem; outline: none; font-size: 1rem;">

      <div style="display: flex; gap: 0.75rem;">
        <button onclick="closeNameModal()"
          style="flex: 1; background: var(--surface-light); border: 1px solid var(--border); border-radius: var(--radius-md); padding: 0.75rem; color: var(--text-muted); font-size: 0.9rem; font-weight: 500;"
          class="hover:text-white">Cancel</button>
        <button onclick="saveNameFromModal()" class="btn-primary"
          style="flex: 2; justify-content: center; padding: 0.75rem; font-size: 0.9rem;">Save Changes</button>
      </div>
    </div>
  </div>

  <!-- Notifications & Toasts -->
  <div id="notif"
    style="position: fixed; top: 1rem; right: 1rem; z-index: 3000; background: var(--surface-light); border: 1px solid var(--border); padding: 1.5rem; border-radius: var(--radius-md); width: 300px; box-shadow: var(--shadow-lg); opacity: 0; pointer-events: none; transition: all 0.3s ease; transform: translateY(-20px);">
    <button onclick="closeNotif()"
      style="position: absolute; top: 0.75rem; right: 0.75rem; background: transparent; color: var(--text-dim); font-size: 1.25rem; line-height: 1;">&times;</button>
    <div style="font-weight: 600; font-size: 0.9rem; margin-bottom: 4px;" id="notifTitle">New File Received</div>
    <p id="notifSub"
      style="font-size: 0.8rem; color: var(--text-muted); margin-bottom: 1.5rem; overflow: hidden; text-overflow: ellipsis;">
      filename.ext</p>
    <button onclick="downloadNotifFile()" class="btn-primary"
      style="width: 100%; justify-content: center; font-size: 0.85rem;">Download</button>
  </div>

  <div id="toast"
    style="position: fixed; bottom: 2rem; left: 50%; transform: translateX(-50%) translateY(20px); z-index: 4000; background: var(--accent); color: #fff; padding: 0.5rem 1.5rem; border-radius: var(--radius-full); font-size: 0.85rem; font-weight: 500; opacity: 0; transition: all 0.3s ease;">
    Copied to clipboard
  </div>

  <style>
    @media (max-width: 600px) {
      .hidden-sm {
        display: none;
      }

      .xs-show {
        display: block !important;
      }
    }
  </style>

  <footer style="margin-top: 8rem; border-top: 1px solid var(--border); padding: 4rem 1.5rem; text-align: center;">
    <div style="display: flex; justify-content: center; gap: 2rem; margin-bottom: 2rem;">
      <span class="text-dim" style="font-size: 0.75rem; letter-spacing: 0.1em; text-transform: uppercase;">Built with Go
        &
        WebRTC</span>
    </div>
    <div class="text-dim" style="font-size: 0.8rem;">
      &copy; 2026 GoShare. All rights reserved.
    </div>
  </footer>

  <script src="/static/js/shared.js"></script>
  <script src="/static/js/app.js"></script>
</body>

</html>